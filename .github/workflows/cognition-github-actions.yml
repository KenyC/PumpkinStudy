on: [push]

jobs:
  cognition-deploy:
    runs-on: ubuntu-latest
    name: Deploy experiment to Cognition
    steps:
      - uses: actions/checkout@v3
      
      # Step to run the Python script
      - name: Run trial generation script
        run: python3 scripts/generate_trials.py

      # Step to replace the content of the repo with the content of the www/ folder
      - name: Replace repo content with www folder content
        run: |
          tmp_dir=$(mktemp -d)
          mv * "$tmp_dir"
          mv "$tmp_dir"/www/* .
      
      - uses: javidalpe/cognition-deploy-action@v1.1.2
        id: deploy
        with:
          personal-access-token: ${{secrets.PERSONAL_ACCESS_TOKEN}}

      - run: echo "The public link to the task is ${{ steps.deploy.outputs.link }}"
